# 智能配图系统规格书（AI Smart Home Hub）

> 目标：在 **不依赖亚马逊产品图片** 的前提下，打造一套自动化、可审计、可扩展的图片管理与匹配系统，确保 **主题强匹配、版权合规、SEO 友好、提高转化（RPM/CTR）**，同时控制成本与运维复杂度。

---

## 0. 成功标准（面向变现）
- **匹配度**：文章首屏 Hero 与内文插图的 **主题相似度≥0.35（CLIP 余弦）**，且通过规则校验（类目、协议、用途等）
- **SEO**：LCP ≤ 2.5s；图片均有自然语言 `alt`、`figcaption` 与 `ImageObject` 结构化数据；站点有 `image-sitemap.xml`
- **合规**：每张图有可溯源 **license/credit**；禁止静态价格/星级覆盖在图上（避免误导）
- **检测友好**：视觉元素呈现为 **“信息图/流程图/设备抽象图”** 与 **品牌媒体包图片** 的混用，避免“千篇一律图库照”与低质 AI 合成痕迹
- **自动化**：文章发布 → 120 秒内完成：检索 → 重排 → 裁切 → 生成 alt/JSON‑LD → 上 CDN

---

## 1. 系统总览（三层架构）
**A. 召回层（Retrieval）**
- 来源一：**图库 API**（Unsplash/Pexels/Pixabay）— 用**语义查询构造器**生成多候选查询
- 来源二：**品牌媒体包/新闻稿图**（自建白名单源，按品牌维护许可条款）
- 来源三：**自制可视化**（自动生成的示意图/对比表/协议关系图；避免真实产品外观侵权）

**B. 排序层（Rerank）**
- 模型：本地 **CLIP ViT‑B/32** 向量（或 E5‑V），计算 **文章摘要/实体** 与候选图片的相似度
- 规则：类目一致性（plug/cam/lock/thermostat）、协议关键词（Matter/Thread/Zigbee）、使用场景（房间/装置）、低风险风格优先（示意/场景而非人物特写）

**C. 生成层（Fallback）**
- 当召回不足或匹配度 < 阈值：**生成信息图/框图**（非真实产品照），含 3–5 个关键点（协议、功率、本地控制、需网关）
- 仅在必要时使用生成；**不要**用 AI 伪造真实产品外观

---

## 2. 数据与元信息规范
**images 表（例）**
- `id`（sha1 内容哈希）｜`src_url`｜`cdn_url`｜`width/height`｜`source`（unsplash/pexels/pixabay/brand/custom）
- `license`（URL/文本）｜`credit`（作者/品牌）｜`terms_snapshot`（当时条款快照）
- `tags`（协议/类目/场景）｜`entities`（品牌、型号）｜`dominant_color`
- `clip_vec`（float[512]）｜`phash`（pHash 去重）｜`safe`（nsfw/人脸/商标检测标志）
- `last_used_at`｜`alt`｜`caption`｜`jsonld`（ImageObject 片段）

**article_images 表（多对多）**
- `article_id`｜`image_id`｜`slot`（hero/inline/faq）｜`match_score`｜`rule_flags`

---

## 3. 匹配流程（伪代码）
```python
# 输入：article {title, h1, headings, entities, category, protocols}
# 输出：{hero, inline[]} + alt/caption/jsonld

summary = LLM.summarize(article, style="结论先行+三要点")
queries = build_queries(summary, entities, category, protocols)   # 多策略：语义/关键词/同义词
candidates = []
for q in queries:
    candidates += search_stock_apis(q, k=20)
    candidates += search_brand_whitelist(q, k=10)

candidates = dedupe_by_url_phash(candidates)

# 视觉语义重排
text_vec = clip_encode(summary)
for img in candidates:
    img_vec = clip_encode(fetch_thumb(img))
    img.score = cosine(text_vec, img_vec)
    img.rule = rule_score(img, category, protocols)  # 类目/协议/风格/人脸/侵权风险

ranked = sort_by(img.score * 0.7 + img.rule * 0.3)

if top.score < 0.35:   # 阈值可按类目调参
    hero = generate_infographic(summary, tokens=[category, protocols])
else:
    hero = smartcrop(top, target_ratio=16/9)

inline = select_diverse(ranked[1:10], by=[scene, color, angle])

# alt/caption
alt = write_alt(summary, maxlen=110)
caption = write_caption(entities, sources=img.credit)
jsonld = build_imageobject(hero, caption, license, credit)
```

**规则打分示例**
- `+0.2`：类目词命中（plug/camera/lock 等）
- `+0.1`：协议词命中（Matter/Thread/Zigbee）
- `+0.1`：场景（插座/面板/墙面，而非摆拍人物）
- `-0.3`：检测到明显品牌 Logo 且来源非品牌媒体包
- `-0.5`：人脸/儿童/家庭肖像（避免敏感/隐私与误导）

---

## 4. 查询构造器（提升召回）
**输入**：`category, protocols, usecases, locale`  
**输出**：多候选查询（中英混合）
- `"{category}" + "{protocol}" + home setup`
- `"{category}" + wall socket + closeup`
- `智能{category} + 安装 + 示意`
- `{brand} media kit`（白名单源）

> 对每个查询设置 **负样本**：`-person -face -family -child -logo -brandname`（除非是白名单品牌媒体包）

---

## 5. 生成层（只做信息图/流程图）
- 模板：`Hero • 16:9`、`Inline • 4:3 / 1:1`
- 元素：标题（Best Smart Plugs 2025）、三要点（协议/功率/本地控制）、小图标（SVG）、中性色背景
- 生成方式：本地 **Pillow/CairoSVG** 合成；或最小成本调用图形模板引擎（不必调用扩散模型）
- 优点：原创度高、版权安全、**可 A/B**（不同配色与要点排序）

---

## 6. 存储与缓存
**对象存储**：Cloudflare R2（或 S3 兼容）  
**CDN/变体**：Cloudflare Images/Image Resizing 或 ImgProxy/Nginx + Thumbor

**命名规范**
- `/{env}/{category}/{yyyy}/{mm}/{sha1[:8]}_{w}x{h}.webp`
- 以 **内容哈希** 作为主键，便于去重与缓存命中

**处理链**
- 原图 → 去 EXIF（隐私）→ WebP/AVIF → 生成多尺寸（320/640/960/1280/1600）→ Dominant color
- `srcset/sizes`、`loading=lazy`、首屏 Hero：`fetchpriority="high"` + `preload`

**失效策略**
- 只增不改：新文件名包含尺寸与哈希；CDN TTL 1 年，HTML 侧缓存可短些

---

## 7. Hugo 集成（可直接套用）
**短代码：`hero`**
```go-html-template
{{/* layouts/shortcodes/hero.html */}}
<figure class="hero">
  <img src="{{ .Get "src" }}" width="{{ .Get "w" }}" height="{{ .Get "h" }}"
       alt="{{ .Get "alt" }}" fetchpriority="high"/>
  {{ with .Get "caption" }}<figcaption>{{ . }}</figcaption>{{ end }}
</figure>
{{ partial "imageobject.html" (dict "src" (.Get "src") "alt" (.Get "alt") "caption" (.Get "caption") ) }}
```

**结构化数据：`ImageObject`**
```go-html-template
{{/* layouts/partials/imageobject.html */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ImageObject",
  "url": "{{ .src }}",
  "caption": {{ jsonify (or .caption "") }},
  "creditText": "AI Smart Home Hub",
  "license": "https://creativecommons.org/licenses/by/",
  "acquireLicensePage": "https://www.ai-smarthomehub.com/licensing/"
}
</script>
```

**内文插图：`figure`**
```go-html-template
{{/* layouts/shortcodes/fig.html */}}
<figure>
  <img src="{{ .Get "src" }}" alt="{{ .Get "alt" }}" loading="lazy"/>
  {{ with .Get "caption" }}<figcaption>{{ . }}</figcaption>{{ end }}
</figure>
```

---

## 8. 版权与风险控制
- 仅使用：
  1) **图库**（记录作者与许可链接）；
  2) **品牌媒体包/新闻稿**（入白名单，保存截图与许可条款快照）；
  3) **自制信息图/图标**（CC0 或自绘 SVG）
- 过滤：人脸/儿童/商标大露出（非品牌白名单）；医疗/监控等敏感场景慎用
- 每图保留 `credit` 与 `license`，在文章页尾集中列出“Images & Credits”区块（不影响主内容）

---

## 9. SEO 信号与“AI 痕迹”降低策略
- **原创可视化**：每篇至少 1 张自制信息图（独特性强，易获自然链接）
- **自然语言 `alt`**：由摘要生成，**限制 80–120 字符**，避免关键词堆砌：
  - 例：`alt="对比三款智能插座：Matter/Thread、额定功率、本地控制与是否需网关的差异示意"`
- **文件名可读**：`smart-plugs_matter-thread_local-control.webp`
- **上半屏展示**：Hero 参与 LCP，`preload` + 正确尺寸
- **ImageObject**：提供 `caption/credit/license`；站点级 `image-sitemap.xml`
- **多样来源**：图库 + 媒体包 + 自制图，避免“模板化图库脸”

---

## 10. 监控与 A/B
- **质量**：CLIP 匹配度、规则分、人工抽检通过率
- **性能**：LCP/CLS；图片命中率（CDN/HIT）
- **商业**：含图文章 CTR、亚马逊点击率、RPM（对照无图/差图版本）
- **实验**：Hero 使用“实景/示意图/信息图”的三臂对照

---

## 11. 落地清单（给工程）
1) 新建 `images`/`article_images` 表；落地 `clip_encode`、`phash`、`dominant_color`
2) 写 `build_queries()` 与 `rule_score()`；定义各类目的负样本
3) 接入图库 API（统一包装），加入 **品牌白名单抓取器**（仅元数据入库）
4) 落地 **Pillow 信息图生成器**（Hero/Inline 模板）
5) 上 R2 + Cloudflare Images/Resizing；`srcset/sizes`、`preload`、`fetchpriority`
6) Hugo 短代码与 `ImageObject` partial；生成 `image-sitemap.xml`
7) 监控面板：CLIP 匹配均值、召回量、LCP、CTR、RPM

---

## 12. 示例 Alt/Caption 生成（模板）
**alt 模板**：
```
对比{category}的关键参数：{protocols}、{needs_hub}、{local_api}，用于{usecase}
```
**caption 模板**：
```
示意图：基于公开规格整理。来源：品牌资料与认证数据库；如有勘误请联系 corrections@ai-smarthomehub.com
```

---

## 13. 成本与运维
- 召回与重排：本地 CPU 版 CLIP 即可；每文 < 200ms（缓存向量）
- 存储：R2 $0.015/GB/月；Resizing 按请求计费（可用缓存策略控制）
- 生成：信息图模板一次开发，后续零成本批量产出

---

### 结论
通过“**图库/媒体包召回 + 语义重排 + 规则过滤 + 信息图兜底**”的组合拳，你能在**零人工**条件下持续产出 **高匹配、合规、SEO 友好** 的配图，并用监控与 A/B 迭代匹配阈值与模板，最终把 **流量→点击→转化** 的链路稳定放大。

